-- MySQL Script generated by MySQL Workbench
-- 08/21/15 09:15:39
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema FANFOU
-- -----------------------------------------------------
-- fanfou
-- 

-- -----------------------------------------------------
-- Schema FANFOU
--
-- fanfou
-- 
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `FANFOU` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ;
USE `FANFOU` ;

-- -----------------------------------------------------
-- Table `FANFOU`.`USER`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`USER` (
  `USER_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `USER_NAME` VARCHAR(45) NULL COMMENT '',
  `EMAIL` VARCHAR(45) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NOT NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`USER_ID`)  COMMENT '')
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FANFOU`.`ROLE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`ROLE` (
  `ROLE_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `ROLE_NAME` VARCHAR(45) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NOT NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`ROLE_ID`)  COMMENT '')
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FANFOU`.`USER_ROLE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`USER_ROLE` (
  `USER_ROLE_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `USER_ID` BIGINT(20) NULL COMMENT '',
  `ROLE_ID` BIGINT(20) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NOT NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`USER_ROLE_ID`)  COMMENT '',
  INDEX `FK_USER_ROLE_USER_idx` (`USER_ID` ASC)  COMMENT '',
  INDEX `FK_USER_ROLE_ROLE_idx` (`ROLE_ID` ASC)  COMMENT '')
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FANFOU`.`CUSTOMER_ORDER`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`CUSTOMER_ORDER` (
  `ORDER_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `USER_ID` BIGINT(20) NULL COMMENT '',
  `ORDER_STATE` VARCHAR(10) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NOT NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`ORDER_ID`)  COMMENT '',
  INDEX `FK_ORDER_USER_idx` (`USER_ID` ASC)  COMMENT '')
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FANFOU`.`GOODS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`GOODS` (
  `GOODS_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `GOODS_NAME` VARCHAR(45) NULL COMMENT '',
  `PRICE` FLOAT(10,2) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`GOODS_ID`)  COMMENT '')
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FANFOU`.`ORDER_DETAIL`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FANFOU`.`ORDER_DETAIL` (
  `DETAILE_ID` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '',
  `ORDER_ID` BIGINT(20) NULL COMMENT '',
  `GOODS_ID` BIGINT(20) NULL COMMENT '',
  `PRIVCE` FLOAT(10,2) NULL COMMENT '',
  `COUNT` BIGINT(20) NULL COMMENT '',
  `CREATED_DATETIME` TIMESTAMP NULL DEFAULT '2015-08-18 00:00:00' COMMENT '',
  `UPDATED_DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT '',
  PRIMARY KEY (`DETAILE_ID`)  COMMENT '',
  INDEX `FK_ORDER_DETAIL_ORDER_idx` (`ORDER_ID` ASC)  COMMENT '',
  INDEX `FK_ORDER_DETAIL_GOODS_idx` (`GOODS_ID` ASC)  COMMENT '')
ENGINE = InnoDB;

USE `FANFOU`;

DELIMITER $$
USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`USER_BEFORE_INSERT` BEFORE INSERT ON `USER` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$

USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`ROLE_BEFORE_INSERT` BEFORE INSERT ON `ROLE` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$

USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`USER_ROLE_BEFORE_INSERT` BEFORE INSERT ON `USER_ROLE` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$

USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`CUSTOMER_ORDER_BEFORE_INSERT` BEFORE INSERT ON `CUSTOMER_ORDER` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$

USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`GOODS_BEFORE_INSERT` BEFORE INSERT ON `GOODS` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$

USE `FANFOU`$$
CREATE DEFINER = CURRENT_USER TRIGGER `FANFOU`.`ORDER_DETAIL_BEFORE_INSERT` BEFORE INSERT ON `ORDER_DETAIL` FOR EACH ROW
BEGIN
	SET NEW.CREATED_DATETIME = NOW();
END
$$


DELIMITER ;
CREATE USER 'fanfou' IDENTIFIED BY 'fanfoutest';

GRANT ALL ON `mydb`.* TO 'fanfou';
GRANT ALL ON `FANFOU`.* TO 'fanfou';

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
